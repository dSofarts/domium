@startuml Containers
!includeurl https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(client, "Client", "Заказчик")
Person(manager, "Manager", "Менеджер")

System_Boundary(sys, "Domium Application") {
  Container(frontend, "Web PWA", "", "UI для заказчика и строителя")

  Container(apiGateway, "API Gateway", "Spring Cloud Gateway", "Единая точка входа, JWT, маршрутизация")

  Container_Boundary(services, "Backend Services") {
    Container(projectSvc, "Project Service", "Spring Boot", "Каталог проектов, выбор проекта")
    Container(buildingSvc, "Building Service", "Spring Boot", "Объекты строительства, этапы, видео")
    Container(documentSvc, "Document Service", "Spring Boot", "Документы, статусы, подписание (mock/real)")
    Container(chatSvc, "Chat Service", "Go + WebSocket", "Чат по объекту строительства")
    Container(notificationSvc, "Notification Service", "Go/Java", "Email/SMS/push уведомления (опционально)")
  }

  Container_Boundary(data, "Data Stores") {
    ContainerDb(pg, "PostgreSQL", "RDBMS", "projects, buildings, documents, chat_archive, notifications")
    Container(redis, "Redis", "Cache/Store", "chat recent messages (опционально)")
    Container(minio, "MinIO", "S3-compatible", "файлы документов")
  }

  Container(keycloak, "Keycloak", "Auth", "Users, roles (CLIENT/MANAGER)")
}

Rel(client, frontend, "Использует", "HTTPS")
Rel(manager, frontend, "Использует", "HTTPS")

Rel(frontend, apiGateway, "REST / WebSocket", "/api/**, /ws/**")
Rel(apiGateway, projectSvc, "Маршрутизирует", "HTTP")
Rel(apiGateway, buildingSvc, "Маршрутизирует", "HTTP")
Rel(apiGateway, documentSvc, "Маршрутизирует", "HTTP")
Rel(apiGateway, chatSvc, "Маршрутизирует", "WS")
Rel(apiGateway, notificationSvc, "Маршрутизирует", "HTTP")

Rel(apiGateway, keycloak, "Проверяет JWT", "OIDC / JWKS")

Rel(projectSvc, pg, "Read/Write", "JDBC")
Rel(buildingSvc, pg, "Read/Write", "JDBC")
Rel(documentSvc, pg, "Read/Write", "JDBC")
Rel(chatSvc, pg, "Archive", "JDBC")
Rel(notificationSvc, pg, "Read/Write", "JDBC")

Rel(documentSvc, minio, "Upload/Download", "S3 API")
Rel(chatSvc, redis, "Store recent messages", "Redis protocol")

@enduml